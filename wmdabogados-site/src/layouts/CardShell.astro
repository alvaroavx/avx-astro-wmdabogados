---
import SEO from "../components/SEO.astro";
import CardNavigation from "../components/CardNavigation.astro";
import { CARD_ROUTES } from "../utils/cards";
import "../styles/base.css";

const {
  title = "WMD Consultores",
  description = "Asesoria juridica para personas y empresas en areas bancaria, financiera, comercial y tributaria.",
} = Astro.props;

const normalizePath = (path: string) => {
  if (path !== "/" && path.endsWith("/")) return path.slice(0, -1);
  return path;
};

const currentPath = normalizePath(Astro.url.pathname);
---

<html lang="es" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <SEO title={title} description={description} url={Astro.url.href} />
    <link
      rel="stylesheet"
      media="(max-width: 991.98px)"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body class="m-0 h-full bg-gray-50 text-gray-900 antialiased">
    <a href="#card-content" class="sr-only focus:not-sr-only focus:absolute focus:top-3 focus:left-3 rounded-md bg-petroleo px-3 py-2 text-white">
      Saltar al contenido principal
    </a>

    <div class="desktop-shell relative grid min-h-[100svh] grid-rows-[56px,auto,54px,28px] overflow-visible md:h-[100svh] md:grid-rows-[72px,1fr,72px,34px] md:overflow-hidden">
      <header class="z-20 flex items-center justify-between gap-3 bg-[#0F4C5C] px-4 text-white md:px-8">
        <a href="/" class="brand-wordmark h-full text-white hover:text-white" aria-label="Ir a inicio">
          <span class="brand-wmd">WMD</span>
          <span class="brand-consultores">CONSULTORES</span>
        </a>

        <nav aria-label="Secciones" class="flex items-center gap-1 overflow-x-auto whitespace-nowrap py-1 md:gap-2">
          {CARD_ROUTES.map((route) => (
            <a
              href={route.path}
              class:list={[
                "rounded-full px-3 py-1 text-xs font-medium text-white/95 transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white md:text-sm",
                currentPath === route.path ? "bg-white/20" : "hover:bg-white/15",
              ]}
            >
              {route.shortLabel}
            </a>
          ))}
        </nav>
      </header>

      <main id="card-content" class="relative h-auto overflow-visible md:h-full md:overflow-hidden" role="main">
        <slot name="desktop">
          <slot />
        </slot>
        <CardNavigation currentPathname={currentPath} />
      </main>

      <footer class="z-10 flex items-center justify-center bg-[#0F4C5C] px-4 text-center text-xs text-white md:text-sm">
        <p class="max-w-6xl">
          Dirección: Próximamente | Teléfono: (56) 2 2415 9171 | Correo: contacto@wmd.cl
        </p>
      </footer>

      <div class="z-10 flex items-center justify-center bg-[#176D7A] px-3 text-center text-[11px] text-white md:text-xs">
        <p>
          <a href="https://avx.cl/" target="_blank" rel="noopener noreferrer" class="text-white underline underline-offset-2 hover:text-white">
            Desarrollado por AVX Informática
          </a>
          {" "} {" "}© 2026 Todos los derechos reservados.
        </p>
      </div>
    </div>

    <div class="mobile-shell min-vh-100 bg-light">
      <header class="bg-petroleo text-white border-bottom border-white border-opacity-25">
        <div class="container-fluid py-3 text-center">
          <a href="/" class="d-inline-block text-white text-decoration-none fw-bold fs-5">WMD CONSULTORES</a>
          <nav class="d-flex flex-nowrap gap-2 overflow-auto pt-2" aria-label="Secciones móvil">
            {CARD_ROUTES.map((route) => (
              <a
                href={route.path}
                class:list={[
                  "btn btn-sm rounded-pill text-nowrap",
                  currentPath === route.path ? "btn-light text-petroleo fw-semibold" : "btn-outline-light",
                ]}
              >
                {route.shortLabel}
              </a>
            ))}
          </nav>
        </div>
      </header>

      <main class="container-fluid py-3">
        <slot name="mobile">
          <slot />
        </slot>
      </main>

      <footer class="mt-3 bg-petroleo text-white py-3">
        <div class="container-fluid text-center small text-white">
          Dirección: Próximamente | Teléfono: (56) 2 2415 9171 | Correo: contacto@wmd.cl
        </div>
      </footer>

      <div class="bg-[#176D7A] py-2 text-center text-[11px] text-white">
        <a href="https://avx.cl/" target="_blank" rel="noopener noreferrer" class="text-white underline underline-offset-2">Desarrollado por AVX Informática</a>
        {" "}© 2026 Todos los derechos reservados.
      </div>
    </div>

    <script is:inline>
      const fitTextBlocks = () => {
        document.querySelectorAll("[data-autofit]").forEach((element) => {
          const min = Number(element.getAttribute("data-autofit-min") ?? 8);
          const max = Number(element.getAttribute("data-autofit-max") ?? 15);
          let size = max;

          element.style.fontSize = `${size}px`;

          while (size > min && (element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth)) {
            size -= 0.25;
            element.style.fontSize = `${size}px`;
          }
        });
      };

      const initHorizontalTabs = () => {
        document.querySelectorAll("[data-tabs]").forEach((tabsRoot) => {
          const buttons = tabsRoot.querySelectorAll("[data-tab-target]");
          const panels = tabsRoot.querySelectorAll("[data-tab-panel]");

          const activate = (id) => {
            buttons.forEach((button) => {
              const isActive = button.getAttribute("data-tab-target") === id;
              button.setAttribute("aria-selected", String(isActive));
              button.setAttribute("tabindex", isActive ? "0" : "-1");
              button.classList.toggle("bg-petroleo", isActive);
              button.classList.toggle("text-white", isActive);
              button.classList.toggle("bg-petroleo/10", !isActive);
              button.classList.toggle("text-petroleo", !isActive);
            });

            panels.forEach((panel) => {
              panel.classList.toggle("hidden", panel.getAttribute("data-tab-panel") !== id);
            });

            fitTextBlocks();
          };

          buttons.forEach((button) => {
            button.addEventListener("click", () => activate(button.getAttribute("data-tab-target")));
          });

          const first = buttons[0]?.getAttribute("data-tab-target");
          if (first) activate(first);
        });
      };

      const runCardScripts = () => {
        initHorizontalTabs();
        fitTextBlocks();
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", runCardScripts, { once: true });
      } else {
        runCardScripts();
      }

      window.addEventListener("resize", fitTextBlocks);
    </script>
  </body>
</html>
